<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>LayIM测试</title>
    <link rel="stylesheet" href="../build/css/layui.css" media="all">
</head>
<body>
<script src="../build/layui.js"></script>
<script>
    layui.use('layim', function(layim){
        //先来个客服模式压压精
        layim.config({
            /*是否简约模式（如果true则不显示主面板）*/
            brief: false
            /*获取主面板列表信息，下文会做进一步介绍*/
            ,init: {
                url: 'json/getList.json'
                , data: {}
            }
            /*获取群员接口,类似qq群（返回的数据格式见下文）*/
            ,members: {
                url: 'json/getMembers.json' //接口地址（返回的数据格式见下文）
                ,type: 'get' //默认get，一般可不填
                ,data: {} //额外参数
            }
            /*皮肤./css/modules/layim/skin目录中*/
            ,initSkin: 'testSkin1.jpg'
            /*扩展工具，*/
            ,tool: [{
                alias: 'money' //工具别名
                ,title: '水滴筹' //工具名称
                ,icon: '&#xe636;' //工具图标，参考图标文档
            }]
            //消息盒子页面地址，若不开启，剔除该项即可
            , msgbox: layui.cache.dir + 'css/modules/layim/html/msgbox.html'
            //以下为我们内置的模版，也可以换成你的任意页面。若不开启，剔除该项即可
            ,chatLog: layui.cache.dir + 'css/modules/layim/html/chatLog.html'

        }).chat({
            name: '客服姐姐'
            ,type: 'friend'
            ,avatar: 'http://tp1.sinaimg.cn/5619439268/180/40030060651/1'
            ,id: -2
        });

        //初始最小化聊天界面（悬浮的客服样式）
        layim.setChatMin();
        layim.setFriendGroup({
            type: 'friend'
            ,username: 'xxx' //好友昵称，若申请加群，参数为：groupname
            ,avatar: 'a.jpg' //头像
            ,group: layim.cache().friend //获取好友列表数据
            ,submit: function(group, index){
                //一般在此执行Ajax和WS，以通知对方已经同意申请
                //……

                //同意后，将好友追加到主面板
                layim.addList(data); //见下文
            }
        });

        //监听自定义工具栏点击，以添加代码为例
        layim.on('tool(money)', function (insert) {
            layer.prompt({
                title: '输入您的筹资'
                , formType: 2
                , shade: 0
            }, function (text, index) {
                layer.close(index);
                insert(text + '元'); //将内容插入到编辑器
            });
        });

        //监听layim建立就绪
        layim.on('ready', function (res) {

            //console.log(res.mine);

            layim.msgbox(5); //模拟消息盒子有新消息，实际使用时，一般是动态获得

            //添加好友（如果检测到该socket）
            layim.addList({
                type: 'group'
                , avatar: "http://tva3.sinaimg.cn/crop.64.106.361.361.50/7181dbb3jw8evfbtem8edj20ci0dpq3a.jpg"
                , groupname: 'Angular开发'
                , id: "12333333"
                , members: 0
            });
            layim.addList({
                type: 'friend'
                , avatar: "http://tp2.sinaimg.cn/2386568184/180/40050524279/0"
                , username: '冲田杏梨'
                , groupid: 2
                , id: "1233333312121212"
                , remark: "本人冲田杏梨将结束AV女优的工作"
            });

            setTimeout(function () {
                //接受消息（如果检测到该socket）
                layim.getMessage({
                    username: "Hi"
                    , avatar: "http://qzapp.qlogo.cn/qzapp/100280987/56ADC83E78CEC046F8DF2C5D0DD63CDE/100"
                    , id: "10000111"
                    , type: "friend"
                    , content: "临时：" + new Date().getTime()
                });

                /*layim.getMessage({
                 username: "贤心"
                 ,avatar: "http://tp1.sinaimg.cn/1571889140/180/40030060651/1"
                 ,id: "100001"
                 ,type: "friend"
                 ,content: "嗨，你好！欢迎体验LayIM。演示标记："+ new Date().getTime()
                 });*/

            }, 3000);
        });

        layim.on('sign', function(value){
            console.log(value); //获得新的签名

            //此时，你就可以通过Ajax将新的签名同步到数据库中了。
        });

    });

</script>
</body>
</html>